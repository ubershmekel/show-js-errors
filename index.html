<html>

<head>
    <title>Show Javascript Errors To Users</title>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-4533496-22"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-4533496-22');
    </script>
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- start the snippet -->
    <script>
        //////////
        // This is an error handler to show JS errors to the user.
        // More info at https://github.com/ubershmekel/show-js-errors
        //////////
        var showJsErrorsMessage = "Unexpected error :( please tweet the following to @your-maintainer-handle-here: ";
        function showAlert(message) {
            if (!document.body) {
                // toasts don't work before the body exists, so we postpone the toast.
                setTimeout(function () { showAlert(message); }, 200);
                return;
            };
            var containerId = 'snackAlertsContainer';
            var containerElem = document.getElementById(containerId);
            if (!containerElem) {
                // We need a container so alerts don't overlap
                var containerElem = document.createElement("div");
                containerElem.id = containerId;
                document.body.appendChild(containerElem);
            }
            // Get the snackbar DIV
            var elem = document.createElement("div");
            elem.innerHTML = message;
            // Add the "show" class to DIV
            elem.className = "snackAlert show";
            // After a delay, remove the show class from DIV
            // Make sure this delay fits the css transition duration
            var eraseElementDelay = 6500;
            setTimeout(function () {
                //elem.className = elem.className.replace("show", "");
                elem.parentNode.removeChild(elem);
            }, eraseElementDelay);
            containerElem.appendChild(elem);
        }
    
        window.onerror = function (msg, url, linenumber) {
            // Tell users when errors occur and log on google analytics
            // This is useful to see syntax errors in loaded scripts.
            // http://stackoverflow.com/questions/2604976/javascript-how-to-display-script-errors-in-a-popup-alert/2604997#2604997
            showAlert(showJsErrorsMessage + msg)
            /*
            // Use this to report errors on google analytics
            // but don't forget to add a protection against `ga` being undefined
            var errDetails = msg + '\nURL: ' + url + '\nLine Number: '+ linenumber;
            ga('send', 'exception', {
                'exDescription': errDetails,
                'exFatal': false
            });*/
            // report on dev console too
            return false;
        }
    
        window.addEventListener("unhandledrejection", function (event) {
            // Handle unhandled promises, these should probably just throw, yet here we are.
            showAlert(showJsErrorsMessage + " Broken promise - " + event.reason);
            //throw 'broken promise: ' + event.reason
        });
    </script>
    <style>
        #snackAlertsContainer {
            position: fixed;
            /* Sit on top of the screen */
            z-index: 1;
            /* Add a z-index if needed */
            bottom: 0;
            right: 0;
            /* 30px from the bottom */
            width: 0;
        }
    
        .snackAlert {
            display: none;
            /* Hidden by default. Visible on click */
            margin: auto;
            position: relative;
            right: 54vw;
            width: 50vw;
            bottom: 20px;
            /* `bottom` is tied to the animation below */
            min-width: 250px;
            /* Set a default minimum width */
            margin-bottom: 16px;
            background-color: #933;
            /* Black background color */
            color: #fff;
            /* White text color */
            text-align: center;
            /* Centered text */
            border-radius: 2px;
            padding: 16px;
        }
    
        /* Show the snackbar when clicking on a button (class added with JavaScript) */
    
        .snackAlert.show {
            display: block;
            /* Show the snackbar */
            /* Add animation: Take 0.5 seconds to fade in and out the snackbar. 
                    However, delay the fade out process for 2.5 seconds */
            -webkit-animation: fadein 1.5s, fadeout 3.5s 3.5s;
            animation: fadein 1.5s, fadeout 3.5s 3.5s;
        }
    
        /* Animations to fade the snackbar in and out */
    
        @-webkit-keyframes fadein {
            from {
                bottom: 0;
                opacity: 0;
            }
            to {
                bottom: 20px;
                opacity: 1;
            }
        }
    
        @keyframes fadein {
            from {
                bottom: 0;
                opacity: 0;
            }
            to {
                bottom: 20px;
                opacity: 1;
            }
        }
    
        @-webkit-keyframes fadeout {
            from {
                bottom: 20px;
                opacity: 1;
            }
            to {
                bottom: 0;
                opacity: 0;
            }
        }
    
        @keyframes fadeout {
            from {
                bottom: 20px;
                opacity: 1;
            }
            to {
                bottom: 0;
                opacity: 0;
            }
        }
    </style>
    <!-- end the snippet -->

    <link rel="stylesheet" href="index.css">
</head>

<body>
    <h1>Show a toast when a Javascript error occurs</h1>

    <h2>FAQ</h2>
    <h3>How?</h3>
    <ul>
        <li>
            <a href="https://raw.githubusercontent.com/ubershmekel/show-js-errors/gh-pages/snippet.html">Paste this</a> into your &lt;head&gt;
        </li>
    </ul>

    <h3>Why show Javascript errors to users?</h3>
    <ul>
        <li>
            Because otherwise they'll be needlessly waiting for your app to do what it was supposed to do.
        </li>
        <li>
            You might've forgotten to implement a specific error handler that makes for a better interaction.
        </li>
    </ul>

    <script>
        function funky() {
            JSON.parse('');
        }
    </script>

    <h3>What does it look like when an error occurs?</h3>
    <ul>
        <li>
            <button onclick="funky();">Try out a failed JSON parse</button>
        </li>
        <li>
            <button onclick="callingUndefined();">Try out an undefined function</button>
        </li>
        <li>
            <button onclick="Promise.reject(new Error('woops'));">Try out a promise rejection</button>
        </li>
    </ul>

    <h3>This is suboptimal</h3>
    <ul>
        <li>
            Please
            <a href="https://github.com/ubershmekel/show-js-errors">open an issue or pull request on github</a>.
        </li>
    </ul>

</body>

</html>